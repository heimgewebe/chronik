---
ai_context_version: 1.1

project:
  name: chronik
  summary: Event ingest and processing hub.
  role: central_event_store
  primary_language: python
  visibility: internal

heimgewebe:
  axis:
    - Events
  fleet:
    enabled: true
  wgx:
    profile_expected: true
    guard_smoke_expected: true

interfaces:
  consumes:
    - "HTTP POST /v1/ingest payload"
  produces:
    - "local JSONL files (append-only)"

contracts:
  schemas:
    - path: "docs/aussen.event.schema.json"
      note: "Primary event schema from metarepo"

dependencies:
  internal:
    - name: contracts-mirror
      relationship: uses
      interface:
        - json_schema
        - proto
  external:
    - name: fastapi
    - name: uvicorn
    - name: filelock
    - name: prometheus-fastapi-instrumentator
    - name: slowapi

architecture:
  entrypoints:
    - app.py
  key_paths:
    - path: app.py
      purpose: HTTP ingest + validation + API
    - path: storage.py
      purpose: File I/O + domain validation + locking
    - path: clients/rust/chronik_producer/
      purpose: Rust client library
  data_flow:
    input: HTTP POST /v1/ingest
    processing: JSON validation + domain sanitization
    output: local JSONL files (append-only)

boundaries:
  not_responsible_for:
    - "UI/dashboard (that is leitstand)"
    - "Defining event schemas (contracts repo does that)"
  dangerous_assumptions:
    - "Assume files are always small"
    - "Assume network is always reliable"

conventions:
  branching: "main, feature/*, hotfix/*"
  commit_prefix: "chronik"
  ci_platform: github_actions

documentation:
  adr: docs/adr/
  runbook: docs/runbook.md
  openapi: docs/openapi.yaml

ai_guidance:
  do:
    - validate payloads against contracts (if applicable)
    - use structured logging via ExtraFormatter
    - ensure safe file operations (no path traversal)
  dont:
    - modify generated JSONL files manually
    - bypass sanitize_domain validation
